<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <title>安装 Win10 导致 grub 报 unknown filesystem 的修复 - TILDEN BLOG</title>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="HandheldFriendly" content="True" />


<meta name="description" content="季天冬的个人博客" />

  <meta name="keywords" content="grub,manjaro," />








<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">


<meta name="generator" content="Hexo" />


<meta name="description" content="记录了下在安装 Manjaro 的基础上安装 Windows 10 而导致的 grub 引导失败报 unknown filesystem 的修复全过程。">
<meta name="keywords" content="grub,manjaro">
<meta property="og:type" content="article">
<meta property="og:title" content="安装 Win10 导致 grub 报 unknown filesystem 的修复">
<meta property="og:url" content="http:&#x2F;&#x2F;itiandong.com&#x2F;2019&#x2F;%E5%AE%89%E8%A3%85-Win10-%E5%AF%BC%E8%87%B4-grub-%E6%8A%A5-unknown-filesystem-%E7%9A%84%E4%BF%AE%E5%A4%8D&#x2F;">
<meta property="og:site_name" content="TILDEN BLOG">
<meta property="og:description" content="记录了下在安装 Manjaro 的基础上安装 Windows 10 而导致的 grub 引导失败报 unknown filesystem 的修复全过程。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-11-04T09:57:41.897Z">
<meta name="twitter:card" content="summary">







<link rel="icon" href="/images/favicon.png" />


<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/han-css@3.3.0/dist/han.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro|PT+Serif|Roboto+Slab|Noto+Serif+SC&display=swap">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/styles/atom-one-light.min.css">
<link rel="stylesheet" href="/css/main.css">

</head>
<body>

<header>
  <div class="container">
    <div class="site-name">
      <a class="logo" href="http://itiandong.com">TILDEN BLOG</a>
      <span class="description">Code & Love</span>
    </div>
  </div>
</header>

<main>
  <div class="container">
    <div class="row">
      <section class="content col-md-8 col-12 han-init-context">
        
  <article>
    <h1 class="post-title">
      <a href="/2019/%E5%AE%89%E8%A3%85-Win10-%E5%AF%BC%E8%87%B4-grub-%E6%8A%A5-unknown-filesystem-%E7%9A%84%E4%BF%AE%E5%A4%8D/">安装 Win10 导致 grub 报 unknown filesystem 的修复</a>
    </h1>
    <div class="post-meta">
      <span class="post-meta-item post-meta-date">
  <time datetime="2019-11-04T08:22:20+00:00">2019-11-04</time>
</span>

<span class="post-meta-item post-meta-categories">
  <span class="post-meta-item-indicator">Category:</span>
  
    <a class="category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>, <a class="category-link" href="/categories/%E6%8A%80%E6%9C%AF/%E4%BF%AE%E5%A4%8D/">修复</a>
  
</span>

<span class="post-meta-item post-meta-tags">
  
    <a class="tag-link" href="/tags/grub/" rel="tag">grub</a> <a class="tag-link" href="/tags/manjaro/" rel="tag">manjaro</a>
  
</span>

    </div>

    

    
      <div class="post-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#TL-DR"><span class="toc-text">TL;DR</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#问题描述"><span class="toc-text">问题描述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#解决"><span class="toc-text">解决</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Grub-运行模式"><span class="toc-text">Grub 运行模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修复-grub-配置"><span class="toc-text">修复 grub 配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（可选）控制台模式"><span class="toc-text">（可选）控制台模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更新-grub"><span class="toc-text">更新 grub</span></a></li></ol></li></ol></div>
    

    <div class="post-content"><p>记录了下在安装 <code>Manjaro</code> 的基础上安装 <code>Windows 10</code> 而导致的 <code>grub</code> 引导失败报 <code>unknown filesystem</code> 的修复全过程。</p>
<a id="more"></a>
<h1 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h1><p><strong>适用于 UEFI ！！！</strong></p>
<p><code>grub rescue</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">迭代 ls 找到 manjaro 所在的分区 (hdx,gptx)</span><br><span class="line">set prefix=(hdx,gptx)/boot/grub</span><br><span class="line">set root=hdx,gptx</span><br><span class="line">insmod normal</span><br><span class="line">normal</span><br></pre></td></tr></table></figure>

<p><code>进入系统后</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount | grep /boot/efi <span class="comment"># 找到 efi 所在分区 /dev/sdax</span></span><br><span class="line">sudo update-grub</span><br><span class="line">sudo grub-install /dev/sdax</span><br></pre></td></tr></table></figure>

<p>完结撒花！</p>
<h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>因为种种原因，需要在笔记本上临时装个 <code>Win10</code>。于是找到启动盘，安装镜像，一顿操作后重启。发现居然直接进了 <code>Win10</code> ，隐约感觉有点不对劲，但忍住疑惑开始边进行繁琐的 <code>Win10</code> 配置， 边观看世界赛半决赛 T1 vs G2。配置的差不多后重启进入 <code>Manjaro</code> 却悲剧了。告诉我引导失败，报了 <code>unknown filesystem</code>，并贴心的进入了 <code>grub rescue</code> 模式。这时反应过来可能是安装工具改了磁盘挂载导致 <code>grub</code> 加载失败。</p>
<h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><h2 id="Grub-运行模式"><a href="#Grub-运行模式" class="headerlink" title="Grub 运行模式"></a>Grub 运行模式</h2><p><code>Grub</code> 有两种运行模式， <code>normal</code> 和 <code>rescue</code> ，<code>normal</code> 就是正常情况下那个包含了菜单界面的模式，而当 <code>grub</code> 发现错误时，就会进入 <code>rescue</code> 模式</p>
<p><code>rescue</code> 的常用命令如下：</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">set</td>
<td align="center">查看、编辑环境变量</td>
</tr>
<tr>
<td align="center">ls</td>
<td align="center">查看分区信息</td>
</tr>
<tr>
<td align="center">insmod</td>
<td align="center">加载模块</td>
</tr>
</tbody></table>
<h2 id="修复-grub-配置"><a href="#修复-grub-配置" class="headerlink" title="修复 grub 配置"></a>修复 <code>grub</code> 配置</h2><ol>
<li>使用 <code>ls</code> 命令，列出所有分区。</li>
<li>依次使用 <code>ls (分区)/</code> 命令，直到分区可读且列出了 <code>Manjaro</code> 的 <code>/</code> 为止。记下根目录所在分区 <code>(hdx,gptx)</code>。</li>
<li>输入 <code>set prefix=(hdx,gptx)/boot/grub</code> 和 <code>set root=hdx,gptx</code>，更改环境变量 <code>prefix</code> 和 <code>root</code>。</li>
<li>执行 <code>insmod normal</code> 载入 <code>normal</code> 模块</li>
<li>执行 <code>normal</code> 进入 normal 模式，此时应该可以正常引导进入 <code>Manjaro</code>.</li>
</ol>
<h2 id="（可选）控制台模式"><a href="#（可选）控制台模式" class="headerlink" title="（可选）控制台模式"></a>（可选）控制台模式</h2><p>该小节来自网络，没有尝试过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">进入普通模式，出现菜单，如果加载grub.cfg（错误的）可能出现问题，按shift可以出现菜单，之后按c键进入控制台</span><br></pre></td></tr></table></figure>

<p>进入正常模式后就会出现<code>grub&gt;</code>这样的提示符，在这里支持的命令就非常多了。 </p>
<p>引导系统</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set root=(hd0,msdos1)  #设置正常启动分区</span><br><span class="line">linux /boot/vmlinuz ....  ro text root=/dev/sda1  #加载内核，进入控制台模式</span><br><span class="line">initrd  /boot/initrd ....  #加载initrd.img</span><br><span class="line">boot #引导</span><br></pre></td></tr></table></figure>

<h2 id="更新-grub"><a href="#更新-grub" class="headerlink" title="更新 grub"></a>更新 <code>grub</code></h2><p>进入系统后，打开终端：</p>
<ol>
<li>执行 <code>mount | grep /boot/efi</code>，记下 <code>efi</code> 分区的位置 <code>/dev/sdax</code></li>
<li>执行 <code>sudo update-grub</code> ，该操作会自动检测安装的操作系统，更新 <code>grub</code> 菜单。</li>
<li>执行 <code>sudo grub-install /dev/sdax</code>，重新安装。</li>
</ol>
</div>
    <div class="post-copyright"><p>除另有声明外，本博客文章均采用 <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener">知识共享(Creative Commons) 署名 4.0 国际许可协议</a> 进行许可。转载请注明原作者与文章出处。</p></div>
  </article>

  
    <nav class="post-nav">
      
      
      <div class="post-nav-item post-nav-next">下一篇：
        <a href="/2019/V2Ray-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">V2Ray 安装配置</a>
      </div>
      
    </nav>
  

  
    

  

      </section>
      <aside class="sidebar col-md-3 offset-md-1 col-12">
        
  
  <section class="widget widget-toc">
    <h3 class="widget-title">文章目录</h3>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#TL-DR"><span class="toc-text">TL;DR</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#问题描述"><span class="toc-text">问题描述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#解决"><span class="toc-text">解决</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Grub-运行模式"><span class="toc-text">Grub 运行模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修复-grub-配置"><span class="toc-text">修复 grub 配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（可选）控制台模式"><span class="toc-text">（可选）控制台模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更新-grub"><span class="toc-text">更新 grub</span></a></li></ol></li></ol>
  </section>
  

        

<section class="widget" id="widget-pages">
  <h3 class="widget-title">页面</h3>
  <ul class="menu">
    
      
      <li class="menu-item menu-item-archives">
        <a href="/archives/" title="">归档</a>
      </li>
    
      
      <li class="menu-item menu-item-about">
        <a href="/about/" title="">关于</a>
      </li>
    
  </ul>
</section>

<section class="widget" id="widget-categories">
  <h3 class="widget-title">分类</h3>
  
  
    <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/%E4%BF%AE%E5%A4%8D/">修复</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">安装配置</a></li></ul></li></ul>
  
</section>



<section class="widget" id="widget-links">
  <h3 class="widget-title">其他</h3>
  <ul class="menu">
    
      
      <li class="menu-item menu-item-github">
        <a href="https://github.com/example" title="" target="_blank">GitHub</a>
      </li>
    
      
      <li class="menu-item menu-item-rss">
        <a href="/atom.xml" title="" target="_blank">RSS Feed</a>
      </li>
    
  </ul>
</section>

      </aside>
    </div>
  </div>
</main>

<footer>
  
  <div class="container">
    <p>
      &copy; 2019 <a href="http://itiandong.com">TILDEN BLOG</a>. Proudly published with <a href="https://hexo.io/" target="_blank">Hexo</a>.
      Theme <a href="https://github.com/printempw/hexo-theme-murasaki/" target="_blank">Murasaki</a> by printempw.
    </p>
  </div>
</footer>

<script type="text/javascript" src="//cdn.jsdelivr.net/npm/han-css@3.3.0/dist/han.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/highlight.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/medium-zoom@1.0.4/dist/medium-zoom.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>mediumZoom(document.querySelectorAll('.post-content :not(a) > img, .post-content > img'), { margin: 24 });</script>



</body>
</html>
